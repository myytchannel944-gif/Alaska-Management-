<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TSG Support</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{display:flex;background:#0b0f1a;color:white;}
.sidebar{width:230px;height:100vh;background:#0f1424;padding:20px;}
.sidebar button{width:100%;margin:5px 0;padding:10px;background:#12172b;border:none;color:white;border-radius:8px;cursor:pointer;}
.sidebar button:hover{background:#5865F2;}
.main{flex:1;padding:20px;}
.card{background:#12172b;padding:20px;border-radius:15px;margin-bottom:15px;}
input,textarea,select{width:100%;padding:10px;margin:6px 0;background:#0f1424;border:none;color:white;border-radius:8px;}
.mainbtn{background:#5865F2;border:none;padding:10px;width:100%;border-radius:8px;cursor:pointer;}
.status{padding:4px 8px;border-radius:6px;font-size:12px;}
.open{background:red;}
.progress{background:orange;}
.done{background:green;}
.page{display:none;}
.active{display:block;}
</style>
</head>

<body>

<div class="sidebar">
  <button onclick="showPage('dashboard')">Dashboard</button>
  <button onclick="showPage('create')">Create</button>
  <button onclick="adminLogin()">Admin</button>
</div>

<div class="main">

<div id="login" class="card">
  <h2>Login</h2>
  <input id="username">
  <button class="mainbtn" onclick="login()">Login</button>
</div>

<div id="dashboard" class="page"></div>

<div id="create" class="page">
  <div class="card">
    <input id="name" placeholder="Name">
    <textarea id="message"></textarea>
    <button class="mainbtn" onclick="createReport()">Submit</button>
  </div>
</div>

</div>

<!-- FIREBASE (OLD VERSION = WORKS WITH BUTTONS) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>

/* FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyCPIfra8YuSnh9C5NbglpRdg4KE5aigHDI",
  authDomain: "support-32682.firebaseapp.com",
  databaseURL: "https://support-32682-default-rtdb.firebaseio.com",
  projectId: "support-32682",
  storageBucket: "support-32682.firebasestorage.app",
  messagingSenderId: "911974697786",
  appId: "1:911974697786:web:ac226eb90c19af72dbde03"
});

var db = firebase.database();

var admin=false;
var user="";

/* NAV */
function showPage(p){
  document.querySelectorAll(".page").forEach(x=>x.classList.remove("active"));
  document.getElementById(p).classList.add("active");
}

/* LOGIN */
function login(){
  user=document.getElementById("username").value;
  document.getElementById("login").style.display="none";
  showPage("dashboard");
}

/* ADMIN */
function adminLogin(){
  var code=prompt("Admin code");
  if(code==="6118"){
    admin=true;
    alert("Admin enabled");
  }
}

/* CREATE */
function createReport(){
  var name=document.getElementById("name").value;
  var message=document.getElementById("message").value;

  db.ref("reports").push({
    name:name,
    message:message,
    status:"open"
  });
}

/* LOAD */
db.ref("reports").on("value", snap=>{
  var container=document.getElementById("dashboard");
  container.innerHTML="";

  snap.forEach(child=>{
    var d=child.val();
    var id=child.key;

    var html=`
    <div class="card">
      <p>${d.message}</p>
      <small>${d.name}</small><br>
      <span class="status ${d.status}">${d.status}</span>
    `;

    if(admin){
      html+=`
      <br>
      <button onclick="setStatus('${id}','progress')">Progress</button>
      <button onclick="setStatus('${id}','done')">Done</button>
      `;
    }

    html+=`</div>`;

    container.innerHTML+=html;
  });
});

/* STATUS */
function setStatus(id,s){
  db.ref("reports/"+id).update({status:s});
}

</script>

</body>
</html>
